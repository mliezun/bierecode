---
import { getCollection, type CollectionEntry } from 'astro:content';
import { Icon } from 'astro-icon/components';
import Layout from '../../layouts/main-layout.astro';
import Footer from '../../components/Footer.astro';

export async function getStaticPaths() {
  const updates = await getCollection('updates');
  return updates.map((update) => ({
    params: { slug: update.slug },
    props: { update },
  }));
}

interface Props {
  update: CollectionEntry<'updates'>;
}

const { update } = Astro.props;
const { Content } = await update.render();

function formatDate(date: Date): string {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
  }).format(date);
}
---

<Layout
  title={`${update.data.title} - Bière & Code Paris`}
  description={`Read the latest update: ${update.data.title}`}
>
  <section class="min-h-screen bg-gradient-to-br from-yellow-100 via-white to-white py-16 px-6">
    <div class="max-w-3xl mx-auto space-y-8">
      <div class="flex justify-start">
        <a href="/updates" class="inline-flex items-center text-sm font-medium text-yellow-600 hover:text-yellow-700 transition-colors group">
          <Icon name="lucide:arrow-left" class="w-4 h-4 mr-2 transform group-hover:-translate-x-1 transition-transform" />
          Back to Updates
        </a>
      </div>
      <article class="rounded-3xl bg-white shadow-[0_30px_45px_-35px_rgba(17,24,39,0.4)] border border-yellow-100 overflow-hidden space-y-6 p-8">
        <div class="space-y-4">
          <div class="flex flex-wrap items-start justify-between gap-4">
            <div class="space-y-3">
              <span
                class={`inline-flex items-center px-3 py-1 text-xs font-semibold uppercase tracking-wide rounded-full ${
                  update.data.type === 'event' ? 'bg-purple-100 text-purple-700' : 'bg-yellow-100 text-yellow-700'
                }`}
              >
                {update.data.type === 'event' ? 'Event' : 'Post'}
              </span>
              <h1 class="text-4xl font-bold text-gray-900">{update.data.title}</h1>
            </div>
            <div class="text-right text-xs text-gray-500 space-y-1">
              <p>Published {formatDate(update.data.published)}</p>
              {update.data.updated && update.data.updated.getTime() !== update.data.published.getTime() && (
                <p>Updated {formatDate(update.data.updated)}</p>
              )}
            </div>
          </div>
          <div class="text-base leading-relaxed text-gray-700 prose prose-sm max-w-none">
            <Content />
          </div>
        </div>

        {update.data.type === 'event' && update.data.event && (
          <div class="bg-yellow-50 border border-yellow-100 text-yellow-900 text-sm rounded-2xl px-4 py-3 space-y-1">
            {(update.data.event.date || update.data.event.time) && (
              <p>
                <strong class="font-semibold">When:</strong> {[update.data.event.date, update.data.event.time].filter(Boolean).join(' • ')}
              </p>
            )}
            {update.data.event.location && (
              <p>
                <strong class="font-semibold">Where:</strong> {update.data.event.location}
              </p>
            )}
            {update.data.event.duration && (
              <p>
                <strong class="font-semibold">Duration:</strong> {update.data.event.duration}
              </p>
            )}
          </div>
        )}

        {update.data.tags && update.data.tags.length > 0 && (
          <div class="flex flex-wrap gap-2">
            {update.data.tags.map((tag) => (
              <span class="text-xs uppercase tracking-wide bg-gray-100 text-gray-600 px-3 py-1 rounded-full">#{tag}</span>
            ))}
          </div>
        )}
      </article>
    </div>
  </section>
  <Footer/>
</Layout>
